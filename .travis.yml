sudo: required
services:
- docker
before_install:
- ls -la
- sudo mkdir -p /build/kernel/kitchen
- sudo chown -R $UID:$UID /build
- git clone https://github.com/denysvitali/ramdisk-builder /build/kernel/ramdisk
- ln -s ramdisk.cpio.gz /build/kernel/ramdisk/custom-initramfs.cpio.gz
- ls -la /build/kernel/ramdisk/
- git clone https://github.com/denysvitali/smaug-custom-initram /build/kernel/smaug-custom-initram
- mkdir /build/kernel/linux-smaug;
- sudo mount -o bind $PWD /build/kernel/linux-smaug
script:
- sudo ls -la /build/kernel/
- docker run -v /build/kernel:/kernel --privileged --entrypoint=zsh dvitali/android-build:feb-20 -c 'cd /kernel/ramdisk/; ./build.sh; ls -la /kernel/ramdisk/; cd /kernel/linux-smaug/; make dragon_denvit_defconfig; bash getvendor.sh -f && make -j8 && ./build-image.sh'
before_deploy:
  - sudo chown -R $UID:$UID /build/kernel/
  - ls -la /build/kernel/{kitchen,ramdisk}
  - export RELEASE_PKG_FILES=$(ls /build/kernel/kitchen/*.img)
  - "echo Releasing: $RELEASE_PKG_FILES"
deploy:
  provider: releases
  api_key:
    secure: iAxinDCeXOe0ejli7qZ5GXAZb2lgXgMll27hEBZnTYm8kyNzCX9RV6mWbaQkafMpg9yaBlywRzlKxyIQGYkw1qFSZOYXMOO9XF42n0XIkL5vl4m7fcFMcgBSqc1VvWlxCNSeWXN4dkAtGBmWmBsU5VqBZAYdPBnTMh2vef1DDkPoNh5ht+mTKhBCQzsq+0dmHTnckghahQLdVmj1oufUSE41bJVnWOFRKUXYZglGZVPmnQpZ38kzMoJPoy8MievZFVlrozOlK1U0pb0Iv8q8C61QrRGXaN3RSqKXPlw08+f1caQbKPyg4pCdFjqLFYR5ve608WmJudj0Ui176tvbAPEJNM3dhB+aWw8ctUjVNqql8h7dDPRpasRV7nfE2iEGRsaTfgl1GljJH1/CdOelWpT3HmBNn1ZQxeJnOHkeFGH7Itc4L4c3dWh75dYbO8vhLcal1gJyxx4DRj3U3Y+f9KHhTtfTxQX8UrXCY/NgjEW6TragfU3+hZjG1LT2/KLaWVdqOhstxHp9X8kL+4PMhI0z9/7bvbkaVXEbSuS6u5ix++jtiGBdlCMtWuQkAu44HgShIHgVH3HFC4iVGC7jicar1wwoeSYfDc+wk4DJS7s6bpJWQb06aUlKj7GHrEx7Tfykf9Hz8qlPj7Aw8Rxi65LdGFCrLaE0sC3jZ2ZjLtQ=
  file_glob: true
  file: "${RELEASE_PKG_FILES}"
  on:
    repo: denysvitali/linux-smaug
    all_branches: true
